<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EG SMART โข Wi-Fi Manager</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="app">
    <!-- ุดุงุดุฉ ุชุณุฌูู ุงูุฏุฎูู -->
    <main id="loginView" class="view active">
      <section class="card login-card">
        <h1 class="brand">EG SMART</h1>
        <p class="muted">ุณุฌูู ุงูุฏุฎูู ูููุชุงุจุนุฉ</p>
        <label class="field">
          <span>ุงุณู ุงููุณุชุฎุฏู</span>
          <input id="loginUser" type="text" placeholder="admin" autocomplete="username" />
        </label>
        <label class="field">
          <span>ูููุฉ ุงููุฑูุฑ</span>
          <input id="loginPass" type="password" placeholder="โขโขโขโขโขโขโขโข" autocomplete="current-password" />
        </label>
        <button id="loginBtn" class="btn primary">ุฏุฎูู</button>
        <p id="loginError" class="error hidden">ุจูุงูุงุช ุงูุฏุฎูู ุบูุฑ ุตุญูุญุฉ</p>
      </section>
    </main>

    <!-- ููุญุฉ ุงูุชุญูู -->
    <div id="dashboard" class="dashboard hidden">
      <aside class="sidebar">
        <div class="brand-row">
          <span class="logo">EG</span>
          <strong>SMART</strong>
        </div>
        <nav class="menu" id="menu">
          <button class="menu-item active" data-section="home">ุงูุฑุฆูุณูุฉ</button>
          <button class="menu-item" data-section="cafes">ุงููุงูููุงุช</button>
          <button class="menu-item" data-section="cards">ุงููุฑูุช</button>
          <button class="menu-item" data-section="plans">ุงูุจุงูุงุช</button>
          <button class="menu-item" data-section="reports">ุงูุฅุญุตุงุฆูุงุช</button>
          <button class="menu-item" data-section="logs">ุงูุณุฌูุงุช</button>
          <button class="menu-item" data-section="settings">ุงูุฅุนุฏุงุฏุงุช</button>
          <div class="spacer"></div>
          <button id="logoutBtn" class="menu-item danger">ุชุณุฌูู ุงูุฎุฑูุฌ</button>
        </nav>
      </aside>

      <main class="content">
        <header class="topbar">
          <h2 id="sectionTitle">ุงูุฑุฆูุณูุฉ</h2>
          <div class="top-actions">
            <input id="search" class="search" placeholder="ุจุญุซ ุนุงู ..." />
            <button id="exportBtn" class="btn">ุชุตุฏูุฑ ุจูุงูุงุช</button>
            <label class="btn file-label">
              ุงุณุชูุฑุงุฏ
              <input type="file" id="importInput" accept="application/json" hidden>
            </label>
          </div>
        </header>

        <!-- ุงูุฑุฆูุณูุฉ -->
        <section id="home" class="section active" tabindex="0" aria-labelledby="sectionTitle">
          <div class="grid">
            <article class="card">
              <h3>ูุฑุญุจูุง ุจู ๐</h3>
              <p>ุฅุฏุงุฑุฉ ูุฑูุช Wi-Fi ููููุงูู ูุน ุชุญูู ูุฑูุฒู ูุฑุจุท MikroTik/OpenWRT ุนุจุฑ API.</p>
            </article>
            <article class="card">
              <h3>ููุฎุต ุณุฑูุน</h3>
              <ul class="stats">
                <li><span>ุนุฏุฏ ุงููุงูููุงุช</span><strong id="cafesCount">0</strong></li>
                <li><span>ุนุฏุฏ ุงููุฑูุช</span><strong id="cardsCount">0</strong></li>
                <li><span>ุญุงูุฉ ุงููุธุงู</span><strong id="sysStatus">ุฌุงูุฒ</strong></li>
              </ul>
            </article>
            <article class="card">
              <h3>ุฅุฌุฑุงุกุงุช ุณุฑูุนุฉ</h3>
              <div class="actions">
                <button class="btn primary" data-jump="cafes">ุฅุถุงูุฉ ูุงููู</button>
                <button class="btn" data-jump="cards">ุฅูุดุงุก ูุงุฑุช</button>
              </div>
            </article>
          </div>

          <!-- ๐น ููุญุฉ ุชุญูู ุงููุงููู -->
          <div class="control-panel" style="margin-top:25px; text-align:center;">
            <h3>ููุญุฉ ุชุญูู ุงููุงููู</h3>
            <button id="toggleCafeBtn" 
                    style="padding:10px 20px; background-color:#007bff; color:white; border:none; border-radius:8px; cursor:pointer;">
              โธ๏ธ ุฅููุงู ุงููุงููู ูุคูุชูุง
            </button>
            <button id="installDevicesBtn" 
                    style="padding:10px 20px; background-color:#28a745; color:white; border:none; border-radius:8px; margin-left:10px; cursor:pointer;">
              โ๏ธ ุชุฑููุจ ุงูุฃุฌูุฒุฉ
            </button>
            <p id="statusMsg" style="margin-top:10px; color:gray;"></p>
          </div>
        </section>

        <!-- ุงููุงูููุงุช -->
        <section id="cafes" class="section" tabindex="0">
          <article class="card">
            <div class="header-row">
              <h3>ุงููุงูููุงุช</h3>
              <input id="cafesSearch" class="search" placeholder="ุจุญุซ ุนู ูุงููู..." />
            </div>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr><th>#</th><th>ุงูุงุณู</th><th>ุงูุนููุงู</th><th>ุงููุณุฆูู</th><th>ุงููุงุชู</th><th>ุชุฑููุจ</th><th>ุฅุฌุฑุงุกุงุช</th></tr>
                </thead>
                <tbody id="cafesTable"></tbody>
              </table>
            </div>
            <form id="cafeForm" class="grid-form">
              <label class="field"><span>ุงุณู ุงููุงููู</span><input id="cafeName" required /></label>
              <label class="field"><span>ุงูุนููุงู</span><input id="cafeAddr" /></label>
              <label class="field"><span>ุงููุณุฆูู</span><input id="cafeOwner" /></label>
              <label class="field"><span>ููุจุงูู</span><input id="cafePhone" /></label>
              <label class="field"><span>ุฃุฑุถู</span><input id="cafeLand" /></label>
              <button class="btn primary" type="submit">ุญูุธ</button>
              <input type="hidden" id="cafeId" />
            </form>
          </article>
        </section>

        <!-- ุงููุฑูุช -->
        <section id="cards" class="section" tabindex="0">
          <article class="card">
            <div class="header-row"><h3>ุงููุฑูุช</h3></div>
            <div class="table-wrap">
              <table>
                <thead><tr><th>#</th><th>ุงููุงููู</th><th>ุงูููุฏ</th><th>ุงูุจุงูุฉ</th><th>ุงูุญุงูุฉ</th><th>ุฅุฌุฑุงุกุงุช</th></tr></thead>
                <tbody id="cardsTable"></tbody>
              </table>
            </div>
            <form id="cardForm" class="grid-form">
              <label class="field"><span>ูุงููู</span><input id="cardCafe" placeholder="ุงุณู ุงููุงููู" required /></label>
              <label class="field"><span>ุงูุจุงูุฉ</span><input id="cardPlan" placeholder="ุงุณู ุงูุจุงูุฉ" required /></label>
              <button class="btn primary" type="submit">ุฅูุดุงุก ูุงุฑุช</button>
            </form>
          </article>
        </section>

        <!-- ุงูุฅุนุฏุงุฏุงุช -->
        <section id="settings" class="section" tabindex="0">
          <article class="card">
            <h3>ุงูุฅุนุฏุงุฏุงุช</h3>
            <form id="settingsForm" class="grid-form">
              <label class="field"><span>ุงุณู ุงููุดุฑูุน</span><input id="projectName" value="EG SMART" /></label>
              <label class="field"><span>ุงููุถุน</span>
                <select id="themeMode"><option value="dark" selected>ุฏุงูู</option><option value="light">ูุงุชุญ</option></select>
              </label>
              <button class="btn primary" type="submit">ุญูุธ</button>
              <span id="settingsSaved" class="muted hidden">ุชู ุงูุญูุธ โ</span>
            </form>
          </article>
        </section>
      </main>
    </div>
  </div>

  <script src="script.js"></script>

  <!-- ๐น ุณูุฑูุจุช ุงูุฃุฒุฑุงุฑ ุงูุฌุฏูุฏุฉ -->
  <script>
  const API_URL = "/.netlify/functions/api"; // ูู ุงูุช ุนูู Vercel ุฎููู ููุณ ุงููุณุงุฑ ุฏู

  let cafeStatus = true;

  document.getElementById("toggleCafeBtn").addEventListener("click", async () => {
    cafeStatus = !cafeStatus;
    const btn = document.getElementById("toggleCafeBtn");
    const msg = document.getElementById("statusMsg");

    btn.innerText = cafeStatus ? "โธ๏ธ ุฅููุงู ุงููุงููู ูุคูุชูุง" : "โถ๏ธ ุชุดุบูู ุงููุงููู";
    btn.style.backgroundColor = cafeStatus ? "#007bff" : "#dc3545";
    msg.innerText = cafeStatus ? "โ ุงููุงููู ูุนูู ุงูุขู" : "โ ุชู ุฅููุงู ุงููุงููู ูุคูุชูุง";

    try {
      await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ action: "updateCafeStatus", data: { active: cafeStatus } })
      });
    } catch (err) {
      msg.innerText = "โ๏ธ ุฎุทุฃ ูู ุงูุงุชุตุงู ุจุงูุฎุงุฏู!";
    }
  });

  document.getElementById("installDevicesBtn").addEventListener("click", async () => {
    const msg = document.getElementById("statusMsg");
    msg.innerText = "โณ ุฌุงุฑู ุชุซุจูุช ุงูุฃุฌูุฒุฉ...";
    try {
      await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ action: "installDevices", data: {} })
      });
      msg.innerText = "โ ุชู ุชุฑููุจ ุงูุฃุฌูุฒุฉ ุจูุฌุงุญ!";
    } catch (err) {
      msg.innerText = "โ๏ธ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุชุฑููุจ ุงูุฃุฌูุฒุฉ!";
    }
  });
  </script>
</body>
</html>
